# Optimized RKHunter Configuration Template
# This configuration reduces common false positives while maintaining security

# Basic Settings
UPDATE_MIRRORS=1
MIRRORS_MODE=0
WEB_CMD="/usr/bin/curl"

# Performance Settings
HASH_FUNC="SHA256"
SCAN_MODE_DEV=THOROUGH

# False Positive Reductions

# 1. Allow common hidden directories (most common source of false positives)
ALLOWHIDDENDIR="/dev/.udev"
ALLOWHIDDENDIR="/dev/.static"
ALLOWHIDDENDIR="/dev/.initramfs"
ALLOWHIDDENDIR="/sys/kernel/security"
ALLOWHIDDENDIR="/sys/kernel/debug"
ALLOWHIDDENDIR="/sys/kernel/config"

# 2. Allow common system processes
ALLOWHIDDENPROC="/sbin/udevd"
ALLOWHIDDENPROC="/usr/sbin/sshd"
ALLOWHIDDENPROC="/usr/bin/dbus-daemon"

# 3. Disable problematic tests (uncomment as needed)
# High false positive rate tests
# DISABLE_TESTS="suspscan"              # Suspicious scan - many false positives
# DISABLE_TESTS="hidden_procs"          # Hidden processes - often legitimate
# DISABLE_TESTS="deleted_files"         # Deleted files - system updates cause this
# DISABLE_TESTS="packet_cap_apps"       # Packet capture apps - legitimate tools
# DISABLE_TESTS="apps"                  # Application version checks - frequent updates

# Alternative: Disable specific app version checks instead of all apps
# DISABLE_TESTS="apps:sshd,apps:openssl"

# 4. Network and process allowances
ALLOWPROCS="/usr/sbin/NetworkManager"
ALLOWPROCS="/usr/bin/pulseaudio"
ALLOWPROCS="/usr/sbin/lightdm"

# 5. File property whitelist for user-managed directories
USER_FILEPROP_FILES_DIRS="/usr/local/bin"
USER_FILEPROP_FILES_DIRS="/opt"
USER_FILEPROP_FILES_DIRS="/home/*/bin"

# 6. Port and network monitoring
ALLOWPORTS="tcp:22"
ALLOWPORTS="tcp:80"
ALLOWPORTS="tcp:443"

# Logging and Reporting
VERBOSE=0
APPEND_LOG=1
COPY_LOG_ON_ERROR=1

# Email Configuration
# MAIL-ON-WARNING="root@localhost"     # Enable email alerts
MAIL-ON-WARNING=""                     # Disable email alerts (recommended during tuning)

# Update Configuration
AUTO_X_DETECT=1
WHITELISTED_IS_WHITE=1

# Security Settings (keep enabled)
SCRIPTWHITELIST="/usr/bin/unhide.rb"
SCRIPTWHITELIST="/usr/bin/egrep"
SCRIPTWHITELIST="/usr/bin/fgrep"
SCRIPTWHITELIST="/usr/bin/which"
SCRIPTWHITELIST="/usr/bin/ldd"

# System file integrity (important - keep enabled)
PKGMGR=DPKG                           # Debian/Ubuntu
# PKGMGR=RPM                          # RedHat/CentOS/Fedora

# Additional optimizations for specific environments:

# For containers/Docker (uncomment if running in containers)
# ALLOWHIDDENDIR="/sys/fs/cgroup"
# ALLOWHIDDENDIR="/proc/sys/fs/binfmt_misc"
# DISABLE_TESTS="system_configs_ssh"

# For development systems (uncomment if needed)
# USER_FILEPROP_FILES_DIRS="/usr/local/src"
# ALLOWHIDDENDIR="/tmp/.X11-unix"

# For servers (uncomment specific services as needed)
# ALLOWPROCS="/usr/sbin/apache2"
# ALLOWPROCS="/usr/bin/mysqld"
# ALLOWPROCS="/usr/bin/nginx"

# Notes:
# 1. After applying this configuration, run: sudo rkhunter --propupd
# 2. Test with: sudo rkhunter --check --skip-keypress --report-warnings-only
# 3. Review remaining warnings and add specific whitelists as needed
# 4. Enable email alerts after tuning is complete
# 5. Schedule regular scans: 0 3 * * * /usr/bin/rkhunter --check --quiet
